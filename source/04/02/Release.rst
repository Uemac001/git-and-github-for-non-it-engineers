######################################################################
GitHubのリリース機能を使用してプログラムの公開&バージョン管理を行う
######################################################################

GitHubにはリリースという、自分が作成したプログラムなどを各リリース(バージョン)毎パッケージ化して、公開する機能があります。
また、パッケージを公開しなくてもリリースノートとして使用したりとバージョンの管理がより分かりやすくなります。

こちらは私が管理をお手伝いしているiRICのNays3Dvというソルバーのリポジトリです。
ここではソルバーのバージョンアップの度にリリースを作成し、どのような変更をしたかのコメントを残し、そのバージョンのプログラム一式をzipにまとめたものをDL出来るようにしています。

https://github.com/iRICsolvers/v4_nays3dv/releases

.. figure:: image/Release/020.png

**********************************************************************
手順
**********************************************************************

リリースを作成する際にはGitのタグが必要となります。

そのため、全体の手順としては以下のようになります。

- リリースを作成したい時点のコミットにタグを作成
- タグに対してGitHubでリリースを作成

はじめに
======================================================================

お手頃なリポジトリをご用意ください。

私は中身はダミーデータですが、以下のようなコミットログのあるリポジトリを用意しました。
mainにマージしているコミットがバージョンアップのタイミングのイメージです。

.. figure:: image/Release/030.png



タグを作成
======================================================================

| リリースを作成するために、リリースを作成したい時点のコミットにタグを作成します。
| 主にバージョンアップのタイミングでリリースを作成することがメインだと思います。
| タグ作成は今回は視覚的に操作ができて簡単なSource Treeを使用します。



対象のローカルリポジトリをSource Treeで開く
----------------------------------------------------------------------

| リリースを作成したいプロジェクトを管理しているローカルリポジトリをSource Treeで開いてください。

.. figure:: image/Release/040.png



コミットにタグを作成する
----------------------------------------------------------------------

| タグを作成したいコミットを右クリックして、:menuselection:`タグ...` を選択し、タグ作成ダイアログを開きます。

:guilabel:`タグ名` にタグの名前を記入します。名前は分かりやすくリリース時のバージョン番号などをつけるとよいかと思います。

.. figure:: image/Release/050.png

----------------------------------------------------------------------

名前を入力したら :guilabel:`タグを追加` をクリックしてタグを追加します。

タグが追加されるとコミットログにもタグが表示されています。

.. figure:: image/Release/060.png

----------------------------------------------------------------------

この手順を繰り返してリリースを作成したいコミット全てにタグをつけましょう。

.. figure:: image/Release/070.png

----------------------------------------------------------------------

| タグを作成したらリモートリポジトリにタグをプッシュします。
| :guilabel:`プッシュ` アイコンをクリックしてプッシュダイアログを開いたら左下の :guilabel:`全てのタグをプッシュ` にチェックが入っていることを確認してから :guilabel:`プッシュ` をクリックして実行します。

.. figure:: image/Release/080.png

----------------------------------------------------------------------

リモートリポジトリにタグがプッシュされると、GitHubのリポジトリのページから作成されたタグを確認することができます。

.. figure:: image/Release/090.gif


リリースを作成
======================================================================

| タグの準備ができたら、タグに対してリリースを作成していきます。
| まずはGitHubのリポジトリのページにアクセスして、 :guilabel:`Release` のリンクを開きます。

.. figure:: image/Release/100.png

----------------------------------------------------------------------

| リリースが1つもない場合、以下のような画面が表示されます。 :guilabel:`Create a new release` をクリックしてリリースの編集画面に移動してください。

.. figure:: image/Release/110.png

.. admonition:: 既にリリースがある場合

    既にリリースがある場合には以下のようにリリースの一覧が表示されるので ::guilabel:`Draft a new release` をクリックします。

    .. figure:: image/Release/120.png


----------------------------------------------------------------------

リリースの編集画面が表示されるので、内容を入力して :guilabel:`Publish release` でリリースを作成します。
リリース画面の詳細は :ref:`リリース編集画面の説明` を読んでください。

.. figure:: image/Release/130.png

----------------------------------------------------------------------

リリースが作成されました。
同様の手順を繰り返してリリースを作成してください。

.. figure:: image/Release/140.png


.. _リリース編集画面の説明:

**********************************************************************
リリース編集画面の説明
**********************************************************************

.. figure:: image/Release/150.png

.. _Choose_a_tag:

Choose a tag
======================================================================

.. figure:: image/Release/160.png

| プルダウンでリリースを作成するタグを選択します。
| テキストボックスに入力してタグを検索することもできます。

.. figure:: image/Release/170.png

----------------------------------------------------------------------

| また、直近数件のコミットに対してであれば、ここから新たなタグを作成することも可能です。
| テキストボックスに作成したいタグの名前を入力して :guilabel:`+ Create new tag: 〇〇 on publish` をクリックします。 

.. figure:: image/Release/180.png

Target
======================================================================

.. figure:: image/Release/190.png

| :ref:`Choose_a_tag` で新しくタグを作成する場合に、タグをつけるコミットを選択する項目です。
| ブランチか直近のコミットから選択することが可能です。

ブランチの場合はブランチの指しているコミットにタグを作成します。


.. figure:: image/Release/200.png

直近のコミットタブでは直近のコミット10件程度の中からコミットを選択可能です。それより前のコミットは選択できません。


.. figure:: image/Release/210.png

.. _Previous_tag:

Previous tag
======================================================================

.. figure:: image/Release/220.png

| :ref:`Choose_a_tag` でタグを選択または作成をすると表示される項目です。 :ref:`Generate_release_note` の機能で自動でリリースノートを作成したい場合に選択します。
| 選択したタグより前のバージョンのタグをここで選択してください。

.. figure:: image/Release/230.png

.. _Generate_release_note:

Generate release note
======================================================================

.. figure:: image/Release/240.png

| クリックすると自動でリリースノートを作成してくれます。 :ref:`Previous_tag` で選択したタグから :ref:`Choose_a_tag` で選択したタグまでの差分でリリースノートが作成されます。
| リリースノートの自動作成には :file:`.github` に :file:`release.yml` の作成とプルリクエストを利用したマージをしておく必要があります。

詳しくは公式ドキュメントをご確認ください。

| 自動生成リリース ノート
| https://docs.github.com/ja/repositories/releasing-projects-on-github/automatically-generated-release-notes


Release title
======================================================================

.. figure:: image/Release/250.png

リリースのタイトルを入力します。


Describe this release
======================================================================

.. figure:: image/Release/260.png

| リリースの説明文を記入します。 主に前回からどのような変更があったかなどのリリースノートを書くことが多いかと思います。
| マークダウン記法を使用した記述可能で写真や動画をドラッグアンドドロップで埋め込むことも可能です。マークダウン記法がよくわからなくてもエディタ上部のアイコンから見出し作成、ボールドなどの編集が行えます。

GitHubで使用できる記法などの詳細は公式ドキュメントをご覧ください。

    | GitHub での執筆
    | https://docs.github.com/ja/get-started/writing-on-github

絵文字も使用できます。

    公式ドキュメント

        `絵文字の使用 <https://docs.github.com/ja/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax#using-emojis>`_ ：絵文字の使用方法が記載されています。

        `絵文字チートシート <https://github.com/ikatyang/emoji-cheat-sheet/blob/master/README.md>`_ ：使用できる絵文字と絵文字の名前が確認できます

    外部サイト

        `Emoji Cheat Sheet <https://www.webfx.com/tools/emoji-cheat-sheet/>`_ ：絵文字をクリックするとその絵文字をコピー出来るので便利です


Attach binaries by dropping them here or selecting them
======================================================================

.. figure:: image/Release/270.png

| この領域をクリックしてダイアログでファイルを選択するか、この領域にドラッグアンドドロップするかでリリースにファイルを添付できます。
| このリリース時点のビルドしたプログラムの一式のzipファイルやインストーラーを添付することでユーザーにプログラムを配布することが可能です。ユーザーには作成したリリースのページのリンクを教えて下さい。
| 過去バージョンのアーカイブとしても利用できるので非常に便利です。


Set as a pre-release
======================================================================

.. figure:: image/Release/280.png

作成するリリースが正式公開版ではい場合にチェックを入れます。

Set as the latest release
======================================================================

.. figure:: image/Release/290.png

作成するリリースが最新のリリースの場合にチェックを入れます。
チェックを入れない場合GitHub側が自動でリリースの順番を設定します。

Publish release
======================================================================

.. figure:: image/Release/300.png

編集中のリリースを作成します。

Save draft
======================================================================

.. figure:: image/Release/310.png

編集中のリリースを下書きとして保存します。
